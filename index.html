<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>iGold Simulator | é»ƒé‡‘ç…‰é‡‘è¡“</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #F5F5F7; }
        
        /* Apple-like Inputs */
        .apple-input {
            width: 100%;
            padding: 12px 16px;
            background: #F5F5F7;
            border-radius: 12px;
            font-size: 16px;
            border: 1px solid transparent;
            transition: all 0.2s;
        }
        .apple-input:focus {
            background: #FFFFFF;
            box-shadow: 0 0 0 4px rgba(0, 113, 227, 0.1);
            outline: none;
        }

        /* Animations */
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-6px); } }
        .animate-float { animation: float 3s ease-in-out infinite; }
        
        @keyframes popIn { 0% { transform: scale(0); opacity: 0; } 80% { transform: scale(1.1); } 100% { transform: scale(1); opacity: 1; } }
        .animate-pop { animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }

        .transition-all-card { transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1); }
        
        /* Custom Elements */
        .glass-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 20px 40px rgba(0,0,0,0.05);
        }
    </style>
</head>
<body class="text-slate-800 flex flex-col items-center min-h-screen p-4">

    <header class="mb-6 text-center mt-8">
        <h1 class="text-2xl font-bold tracking-tight text-slate-900">iGold Simulator</h1>
        <p class="text-slate-500 text-sm mt-1">å¥½å¸‚å¤šé»ƒé‡‘é»æ•¸ç…‰é‡‘è¡“</p>
    </header>

    <div class="w-full max-w-5xl grid grid-cols-1 lg:grid-cols-12 gap-6">
        
        <div class="lg:col-span-4 space-y-4">
            <div class="bg-white p-6 rounded-3xl shadow-sm border border-slate-200">
                <h2 class="text-sm font-bold text-slate-400 uppercase tracking-wider mb-4">åƒæ•¸è¨­å®š</h2>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-xs font-semibold text-slate-500 mb-1">å¥½å¸‚å¤šå”®åƒ¹ (Costco Price)</label>
                        <input type="number" id="inputPrice" class="apple-input" value="103439">
                    </div>
                    
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="block text-xs font-semibold text-slate-500 mb-1">é‡é‡ (å…‹)</label>
                            <input type="number" id="inputWeight" class="apple-input" value="19.13" step="0.01">
                        </div>
                        <div>
                            <label class="block text-xs font-semibold text-slate-500 mb-1">å›é¥‹ç‡ (%)</label>
                            <input type="number" id="inputReward" class="apple-input" value="2.0" placeholder="é»‘é‘½å¡+ä¿¡ç”¨å¡">
                        </div>
                    </div>

                    <div class="pt-4 border-t border-slate-100">
                        <label class="block text-xs font-semibold text-slate-500 mb-1">éŠ€æ¨“å›æ”¶åƒ¹ (æ¯éŒ¢)</label>
                        <input type="number" id="inputShopPrice" class="apple-input" value="20350">
                    </div>
                    
                    <div>
                        <label class="block text-xs font-semibold text-slate-500 mb-1">éŠ€æ¨“æ‰£é‡ (%)</label>
                        <input type="number" id="inputLoss" class="apple-input" value="5">
                    </div>

                    <button onclick="initSimulation()" class="w-full bg-black text-white font-medium py-3 rounded-xl hover:bg-slate-800 transition active:scale-95 shadow-lg">
                        é‡ç½®ä¸¦é–‹å§‹æ¨¡æ“¬
                    </button>
                </div>
            </div>
        </div>

        <div class="lg:col-span-8">
            <div class="bg-white rounded-3xl shadow-xl border border-slate-100 overflow-hidden relative h-full flex flex-col">
                
                <div class="bg-slate-50 p-4 border-b border-slate-100 flex justify-between items-center">
                    <div class="flex gap-2">
                        <span id="step-dot-1" class="w-2.5 h-2.5 rounded-full bg-slate-300 transition-colors duration-500"></span>
                        <span id="step-dot-2" class="w-2.5 h-2.5 rounded-full bg-slate-300 transition-colors duration-500"></span>
                        <span id="step-dot-3" class="w-2.5 h-2.5 rounded-full bg-slate-300 transition-colors duration-500"></span>
                        <span id="step-dot-4" class="w-2.5 h-2.5 rounded-full bg-slate-300 transition-colors duration-500"></span>
                    </div>
                    <div class="text-xs font-mono text-slate-400" id="phase-text">æº–å‚™å°±ç·’</div>
                </div>

                <div class="flex-1 relative p-8 flex items-center justify-center bg-slate-50/50">
                    
                    <div id="actor-wallet" class="absolute transition-all-card duration-700 flex flex-col items-center z-20">
                        <div class="text-6xl mb-2 drop-shadow-md">ğŸ‘›</div>
                        <div id="display-cost" class="bg-emerald-100 text-emerald-700 px-3 py-1 rounded-lg font-bold text-sm border border-emerald-200">
                            $-
                        </div>
                        <div class="text-xs text-slate-400 mt-1 font-medium">åˆå§‹æœ¬é‡‘</div>
                    </div>

                    <div id="scene-costco" class="absolute opacity-0 scale-90 transition-all duration-700 flex flex-col items-center">
                        <div class="text-7xl mb-2 grayscale opacity-50">ğŸ›’</div>
                    </div>

                    <div id="actor-gold" class="absolute opacity-0 transition-all duration-700 flex flex-col items-center z-10">
                        <div class="text-6xl animate-float drop-shadow-xl filter brightness-110">ğŸ¥‡</div>
                        <div class="bg-amber-100 text-amber-700 px-2 py-1 rounded text-xs font-bold mt-2">ç´”é‡‘æ‰‹é²</div>
                    </div>

                    <div id="actor-points" class="absolute opacity-0 transition-all duration-700 flex flex-col items-center z-10">
                        <div class="text-4xl animate-bounce drop-shadow-md">ğŸ’</div>
                        <div id="display-points" class="bg-blue-100 text-blue-600 px-2 py-1 rounded-full text-xs font-bold mt-2 border border-blue-200">
                            +0 é»
                        </div>
                    </div>

                    <div id="scene-shop" class="absolute right-10 top-1/2 -translate-y-1/2 opacity-0 transition-all duration-700 flex flex-col items-center">
                        <div class="text-6xl mb-2">ğŸª</div>
                        <div class="text-xs text-slate-400">éŠ€æ¨“</div>
                    </div>

                    <div id="actor-monster" class="absolute bottom-10 opacity-0 transition-all duration-500 flex flex-col items-center">
                        <div class="text-4xl">ğŸ”¥</div>
                        <div class="text-xs text-red-500 font-bold bg-white px-2 rounded-full shadow-sm mt-1">è€—æ 5%</div>
                    </div>

                    <div id="actor-final-cash" class="absolute opacity-0 transition-all duration-700 flex flex-col items-center z-20">
                        <div class="text-5xl mb-2">ğŸ’µ</div>
                        <div id="display-revenue" class="bg-slate-200 text-slate-700 px-3 py-1 rounded-lg font-bold text-sm border border-slate-300">
                            $-
                        </div>
                        <div class="text-xs text-slate-400 mt-1">å›æ”¶ç¾é‡‘</div>
                    </div>

                </div>

                <div class="p-6 bg-white border-t border-slate-100 relative min-h-[140px]">
                    <div id="dialog-box" class="flex gap-4 items-start transition-all duration-300">
                        <div class="text-3xl p-2 bg-slate-50 rounded-2xl">ğŸ’ğŸ»â€â™‚ï¸</div>
                        <div>
                            <h3 id="dialog-title" class="font-bold text-slate-800 text-lg mb-1">æº–å‚™é–‹å§‹</h3>
                            <p id="dialog-text" class="text-slate-600 text-sm leading-relaxed">
                                è«‹è¼¸å…¥å·¦å´åƒæ•¸ï¼Œæˆ‘å€‘ä¾†çœ‹çœ‹é€™ç­†ç”Ÿæ„æ˜¯è³ºæ˜¯è³ ã€‚<br>
                                ç‰¹åˆ¥æ³¨æ„ï¼šæˆ‘å€‘æœƒå°‡<b>ã€Œç¾é‡‘ã€</b>èˆ‡<b>ã€Œé»æ•¸ã€</b>åˆ†é–‹è¨ˆç®—ã€‚
                            </p>
                        </div>
                    </div>
                    
                    <button id="btn-next" onclick="nextStep()" disabled class="absolute right-6 bottom-6 bg-blue-600 text-white px-6 py-2 rounded-full font-bold shadow-lg shadow-blue-200 hover:bg-blue-700 transition-all disabled:opacity-30 disabled:cursor-not-allowed">
                        ä¸‹ä¸€æ­¥ â†’
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ç‹€æ…‹ç®¡ç†
        let state = {
            step: 0,
            cost: 0,
            weightG: 0,
            rewardRate: 0,
            shopPrice: 0,
            lossRate: 0,
            // è¨ˆç®—çµæœ
            pointsValue: 0,
            effectiveWeightQian: 0,
            cashRevenue: 0,
            cashProfit: 0,
            totalProfit: 0
        };

        const els = {
            wallet: document.getElementById('actor-wallet'),
            costco: document.getElementById('scene-costco'),
            gold: document.getElementById('actor-gold'),
            points: document.getElementById('actor-points'),
            shop: document.getElementById('scene-shop'),
            monster: document.getElementById('actor-monster'),
            finalCash: document.getElementById('actor-final-cash'),
            
            displayCost: document.getElementById('display-cost'),
            displayPoints: document.getElementById('display-points'),
            displayRevenue: document.getElementById('display-revenue'),
            
            dialogTitle: document.getElementById('dialog-title'),
            dialogText: document.getElementById('dialog-text'),
            phaseText: document.getElementById('phase-text'),
            btnNext: document.getElementById('btn-next'),
            
            dots: [1,2,3,4].map(i => document.getElementById(`step-dot-${i}`))
        };

        // æ ¼å¼åŒ–è²¨å¹£
        const formatMoney = (num) => new Intl.NumberFormat('zh-TW', { style: 'currency', currency: 'TWD', maximumFractionDigits: 0 }).format(num);

        function initSimulation() {
            // 1. æŠ“å–æ•¸å€¼
            state.cost = parseFloat(document.getElementById('inputPrice').value);
            state.weightG = parseFloat(document.getElementById('inputWeight').value);
            state.rewardRate = parseFloat(document.getElementById('inputReward').value);
            state.shopPrice = parseFloat(document.getElementById('inputShopPrice').value);
            state.lossRate = parseFloat(document.getElementById('inputLoss').value);

            // 2. è¨ˆç®—é‚è¼¯
            state.pointsValue = Math.round(state.cost * (state.rewardRate / 100));
            const weightQian = state.weightG / 3.75;
            state.effectiveWeightQian = weightQian * (1 - (state.lossRate / 100));
            state.cashRevenue = Math.round(state.effectiveWeightQian * state.shopPrice);
            state.cashProfit = state.cashRevenue - state.cost;
            state.totalProfit = state.cashProfit + state.pointsValue;

            // 3. é‡ç½® UI
            state.step = 1;
            resetVisuals();
            els.displayCost.innerText = formatMoney(state.cost);
            els.displayPoints.innerText = `+ ${formatMoney(state.pointsValue)} é»æ•¸`;
            els.displayRevenue.innerText = formatMoney(state.cashRevenue);
            
            els.btnNext.disabled = false;
            updateStep(1);
        }

        function resetVisuals() {
            // é‡ç½®æ‰€æœ‰ä½ç½®å’Œé€æ˜åº¦
            els.wallet.style = "transform: translate(0, 0); opacity: 1;";
            els.costco.style = "opacity: 0; transform: scale(0.9);";
            els.gold.style = "opacity: 0;";
            els.points.style = "opacity: 0;";
            els.shop.style = "opacity: 0; right: 40px;";
            els.monster.style = "opacity: 0;";
            els.finalCash.style = "opacity: 0;";
            
            // é‡ç½®é€²åº¦é»
            els.dots.forEach(d => d.className = "w-2.5 h-2.5 rounded-full bg-slate-300 transition-colors duration-500");
        }

        function nextStep() {
            state.step++;
            updateStep(state.step);
        }

        function updateStep(step) {
            // æ›´æ–°é€²åº¦é»
            els.dots.forEach((d, i) => {
                if (i < step) d.classList.replace('bg-slate-300', 'bg-blue-600');
            });

            switch (step) {
                case 1: // åˆå§‹ç‹€æ…‹
                    els.dialogTitle.innerText = "ç¬¬ä¸€æ­¥ï¼šæŠ•å…¥è³‡æœ¬";
                    els.dialogText.innerHTML = `æˆ‘å€‘æº–å‚™äº† <b>${formatMoney(state.cost)}</b> ç¾é‡‘ã€‚<br>é€™ç­†éŒ¢å³å°‡è®Šæˆå¥½å¸‚å¤šçš„æ¥­ç¸¾ã€‚`;
                    els.phaseText.innerText = "PHASE 1: CAPITAL";
                    break;

                case 2: // è³¼è²·å®Œæˆ (éŒ¢åŒ…æ¶ˆå¤±ï¼Œå‡ºç¾é»ƒé‡‘èˆ‡é»æ•¸)
                    // Animation
                    els.wallet.style.opacity = '0';
                    els.wallet.style.transform = 'scale(0.5)';
                    
                    els.costco.style.opacity = '1';
                    els.costco.style.transform = 'scale(1)';
                    
                    setTimeout(() => {
                        els.gold.style.opacity = '1';
                        els.gold.style.transform = 'translate(-50px, 0)'; // Gold goes left
                        
                        els.points.style.opacity = '1';
                        els.points.style.transform = 'translate(50px, -20px)'; // Points float right
                    }, 400);

                    // Text
                    els.dialogTitle.innerText = "ç¬¬äºŒæ­¥ï¼šå¥½å¸‚å¤šæ¶ˆè²»";
                    els.dialogText.innerHTML = `æ¶ˆè²»å®Œæˆï¼ä½ ç²å¾—äº†å¯¦é«”é»ƒé‡‘ï¼Œé‚„æœ‰ <b>${formatMoney(state.pointsValue)}</b> çš„é»æ•¸å›é¥‹ã€‚<br><span class="text-blue-600 text-xs">æ³¨æ„ï¼šé»æ•¸å·²ç¶“å…¥è¢‹ï¼Œé€™æ˜¯æˆ‘å€‘ç¬¬ä¸€ç­†ç¢ºå®šçš„ç²åˆ©ã€‚</span>`;
                    els.phaseText.innerText = "PHASE 2: PURCHASE & REWARD";
                    break;

                case 3: // å‰å¾€éŠ€æ¨“ (é»ƒé‡‘ç§»å‹•ï¼Œæ€ªç¸å‡ºç¾)
                    // Animation
                    els.costco.style.opacity = '0';
                    els.points.style.transform = 'translate(120px, -150px) scale(0.8)'; // Points move to "safe zone"
                    
                    els.gold.style.transition = 'all 1s ease';
                    els.gold.style.transform = 'translate(0, 0) scale(1.2)'; // Center Gold
                    
                    els.shop.style.opacity = '1';

                    setTimeout(() => {
                        els.monster.style.opacity = '1';
                        els.monster.style.transform = 'translateY(-20px)';
                    }, 600);

                    // Text
                    els.dialogTitle.innerText = "ç¬¬ä¸‰æ­¥ï¼šéŠ€æ¨“è®Šç¾";
                    els.dialogText.innerHTML = `å¸¶è‘—é»ƒé‡‘å»éŠ€æ¨“ã€‚è€é—†èªªè¦æ‰£é™¤ <b>${state.lossRate}%</b> çš„é‡é‡è€—æã€‚<br><span class="text-red-500">é€™éš»ã€Œç«è€—æ€ªç¸ã€æ­£åœ¨åƒæ‰ä½ çš„é»ƒé‡‘åƒ¹å€¼...</span>`;
                    els.phaseText.innerText = "PHASE 3: LIQUIDATION & LOSS";
                    break;

                case 4: // æœ€çµ‚çµç®—
                    // Animation
                    els.gold.style.opacity = '0';
                    els.monster.style.opacity = '0';
                    els.shop.style.opacity = '0.5';
                    
                    els.finalCash.style.opacity = '1';
                    els.finalCash.style.transform = 'translate(-60px, 0)';
                    
                    els.points.style.transition = 'all 0.8s ease';
                    els.points.style.transform = 'translate(60px, 0) scale(1.2)'; // Bring points back to compare

                    // Logic for text color
                    const isCashProfitable = state.cashProfit > 0;
                    const isTotalProfitable = state.totalProfit > 0;
                    
                    const cashClass = isCashProfitable ? 'text-green-600' : 'text-red-500';
                    const totalClass = isTotalProfitable ? 'text-green-600' : 'text-red-500';

                    // Text
                    els.dialogTitle.innerText = "æœ€çµ‚çµæœï¼šçœŸç›¸å¤§ç™½";
                    let resultHTML = `<ul class="space-y-1 text-sm">`;
                    resultHTML += `<li>1. ç¾é‡‘éƒ¨åˆ†ï¼š${formatMoney(state.cashRevenue)} - ${formatMoney(state.cost)} = <b class="${cashClass}">${formatMoney(state.cashProfit)}</b></li>`;
                    resultHTML += `<li>2. é»æ•¸å›é¥‹ï¼š<b class="text-blue-600">+ ${formatMoney(state.pointsValue)}</b> (å·²å…¥è¢‹)</li>`;
                    resultHTML += `<li class="border-t pt-1 mt-1">3. ç¶œåˆæç›Šï¼š<b class="${totalClass} text-base">${formatMoney(state.totalProfit)}</b></li>`;
                    resultHTML += `</ul>`;
                    
                    if (!isCashProfitable && isTotalProfitable) {
                        resultHTML += `<p class="text-xs text-slate-500 mt-2">ğŸ’¡ çµè«–ï¼šç¾é‡‘é›–ç„¶å°è³ ï¼Œä½†é è‘—é»æ•¸å›é¥‹ï¼Œæ•´é«”æ˜¯è³ºçš„ï¼(ä¿—ç¨±ï¼šè³ºé»æ•¸)</p>`;
                    } else if (isCashProfitable) {
                        resultHTML += `<p class="text-xs text-green-600 mt-2">ğŸ‰ çµè«–ï¼šç¾é‡‘å’Œé»æ•¸é›™è´ï¼å®Œç¾çš„å¥—åˆ©ï¼</p>`;
                    } else {
                        resultHTML += `<p class="text-xs text-red-500 mt-2">âš ï¸ çµè«–ï¼šé»æ•¸ä¹Ÿè£œä¸å›åƒ¹å·®ï¼Œé€™ç­†ç”Ÿæ„æœƒè³ éŒ¢ã€‚</p>`;
                    }

                    els.dialogText.innerHTML = resultHTML;
                    els.phaseText.innerText = "PHASE 4: FINAL RESULT";
                    els.btnNext.disabled = true;
                    els.btnNext.innerText = "æ¨¡æ“¬çµæŸ";
                    break;
            }
        }
    </script>
</body>
</html>
