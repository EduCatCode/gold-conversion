<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>iGold Simulator Pro | é»ƒé‡‘ç…‰é‡‘è¡“</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #F5F5F7; /* Apple æ·ºç°èƒŒæ™¯ */
        }
        
        /* Apple é¢¨æ ¼è¼¸å…¥æ¡†è‡ªå®šç¾© */
        .apple-input {
            width: 100%;
            padding: 12px 16px;
            background: #F5F5F7;
            border-radius: 12px;
            font-size: 16px;
            border: 1px solid transparent;
            transition: all 0.2s;
            appearance: none; /* ç§»é™¤é è¨­æ¨£å¼ */
        }
        .apple-input:focus {
            background: #FFFFFF;
            box-shadow: 0 0 0 4px rgba(0, 113, 227, 0.1); /* Apple Blue Glow */
            outline: none;
        }

        /* è‡ªå®šç¾©ä¸‹æ‹‰é¸å–®ç®­é ­ */
        .select-wrapper { position: relative; }
        .select-wrapper::after {
            content: "â–¼";
            font-size: 10px;
            color: #86868B;
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            pointer-events: none;
        }

        /* é—œéµå‹•ç•«å®šç¾© */
        @keyframes float { 
            0%, 100% { transform: translateY(0); } 
            50% { transform: translateY(-6px); } 
        }
        .animate-float { animation: float 3s ease-in-out infinite; }
        
        /* å¹³æ»‘éæ¸¡æ•ˆæœ */
        .transition-all-card { transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1); }
        
        /* ç¦æ­¢é¸å–æ–‡å­— (å„ªåŒ– App è³ªæ„Ÿ) */
        .no-select { user-select: none; -webkit-user-select: none; }
    </style>
</head>
<body class="text-slate-800 flex flex-col items-center min-h-screen p-4 lg:p-8">

    <header class="mb-8 text-center mt-4">
        <h1 class="text-3xl font-bold tracking-tight text-slate-900">iGold Simulator <span class="text-blue-600">Pro</span></h1>
        <p class="text-slate-500 text-sm mt-2">å¥½å¸‚å¤šé»ƒé‡‘é»æ•¸ç…‰é‡‘è¡“ Â· è¦–è¦ºåŒ–è©¦ç®—å·¥å…·</p>
    </header>

    <div class="w-full max-w-6xl grid grid-cols-1 lg:grid-cols-12 gap-8">
        
        <div class="lg:col-span-4 space-y-4">
            <div class="bg-white p-6 rounded-3xl shadow-sm border border-slate-200 sticky top-4">
                <h2 class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-6">Simulation Parameters</h2>
                
                <div class="space-y-5">
                    <div>
                        <label class="block text-xs font-bold text-slate-500 mb-1.5 ml-1">å¥½å¸‚å¤šå”®åƒ¹ (Costco Price)</label>
                        <input type="number" id="inputPrice" class="apple-input font-medium" value="103439">
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs font-bold text-slate-500 mb-1.5 ml-1">é‡é‡ (å…‹)</label>
                            <input type="number" id="inputWeight" class="apple-input font-medium" value="19.13" step="0.01">
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-slate-500 mb-1.5 ml-1">å›é¥‹ç‡ (%)</label>
                            <input type="number" id="inputReward" class="apple-input font-medium" value="2.0" placeholder="2.0">
                        </div>
                    </div>

                    <div>
                        <label class="block text-xs font-bold text-slate-500 mb-1.5 ml-1">æˆè‰² (Purity)</label>
                        <div class="select-wrapper">
                            <select id="inputPurity" class="apple-input font-medium">
                                <option value="1.0" selected>24K (99.99%) - ç´”é‡‘</option>
                                <option value="0.916">22K (91.6%)</option>
                                <option value="0.75">18K (75.0%)</option>
                                <option value="0.585">14K (58.5%)</option>
                                <option value="0.417">10K (41.7%)</option>
                            </select>
                        </div>
                    </div>

                    <div class="border-t border-slate-100 my-2"></div>

                    <div>
                        <label class="block text-xs font-bold text-slate-500 mb-1.5 ml-1">éŠ€æ¨“å›æ”¶åƒ¹ (æ¯éŒ¢)</label>
                        <input type="number" id="inputShopPrice" class="apple-input font-medium" value="20350">
                        <p class="text-[10px] text-slate-400 mt-1.5 ml-1">* è«‹è¼¸å…¥ç´”é‡‘(24K)ä»Šæ—¥ç‰Œåƒ¹ï¼Œç³»çµ±å°‡è‡ªå‹•æ›ç®—æŠ˜æ•¸ã€‚</p>
                    </div>
                    
                    <div>
                        <label class="block text-xs font-bold text-slate-500 mb-1.5 ml-1">éŠ€æ¨“æ‰£é‡ / ç«è€— (%)</label>
                        <input type="number" id="inputLoss" class="apple-input font-medium" value="5">
                    </div>

                    <button onclick="initSimulation()" class="w-full bg-slate-900 text-white font-semibold py-3.5 rounded-2xl hover:bg-black transition transform active:scale-[0.98] shadow-lg mt-2">
                        é‡ç½®ä¸¦é–‹å§‹æ¨¡æ“¬
                    </button>
                </div>
            </div>
        </div>

        <div class="lg:col-span-8">
            <div class="bg-white rounded-3xl shadow-xl border border-slate-100 overflow-hidden relative h-[600px] flex flex-col">
                
                <div class="bg-slate-50/80 backdrop-blur p-4 border-b border-slate-100 flex justify-between items-center z-30">
                    <div class="flex gap-2">
                        <span id="step-dot-1" class="w-2.5 h-2.5 rounded-full bg-slate-300 transition-colors duration-500"></span>
                        <span id="step-dot-2" class="w-2.5 h-2.5 rounded-full bg-slate-300 transition-colors duration-500"></span>
                        <span id="step-dot-3" class="w-2.5 h-2.5 rounded-full bg-slate-300 transition-colors duration-500"></span>
                        <span id="step-dot-4" class="w-2.5 h-2.5 rounded-full bg-slate-300 transition-colors duration-500"></span>
                    </div>
                    <div class="text-[10px] font-mono font-bold text-slate-400 tracking-widest" id="phase-text">READY</div>
                </div>

                <div class="flex-1 relative p-8 flex items-center justify-center bg-slate-50/30 overflow-hidden no-select">
                    
                    <div id="actor-wallet" class="absolute transition-all-card duration-700 flex flex-col items-center z-20">
                        <div class="text-7xl mb-3 drop-shadow-md filter saturate-150">ğŸ‘›</div>
                        <div id="display-cost" class="bg-emerald-100 text-emerald-700 px-4 py-1.5 rounded-xl font-bold text-sm border border-emerald-200 shadow-sm">
                            $-
                        </div>
                        <div class="text-xs text-slate-400 mt-2 font-medium">åˆå§‹æœ¬é‡‘</div>
                    </div>

                    <div id="scene-costco" class="absolute opacity-0 scale-90 transition-all duration-700 flex flex-col items-center">
                        <div class="text-8xl mb-2 grayscale opacity-40">ğŸ›’</div>
                        <div class="text-xs font-bold text-slate-300 uppercase tracking-widest mt-2">COSTCO WHOLESALE</div>
                    </div>

                    <div id="actor-gold" class="absolute opacity-0 transition-all duration-700 flex flex-col items-center z-10">
                        <div class="text-7xl animate-float drop-shadow-2xl filter brightness-110">ğŸ¥‡</div>
                        <div id="gold-label" class="bg-amber-100 text-amber-800 px-3 py-1 rounded-lg text-xs font-bold mt-4 shadow-sm border border-amber-200">
                            ç´”é‡‘é£¾å“
                        </div>
                    </div>

                    <div id="actor-points" class="absolute opacity-0 transition-all duration-700 flex flex-col items-center z-10">
                        <div class="text-5xl animate-bounce drop-shadow-lg">ğŸ’</div>
                        <div id="display-points" class="bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-xs font-bold mt-2 border border-blue-200 shadow-sm">
                            +0 é»
                        </div>
                    </div>

                    <div id="scene-shop" class="absolute right-12 top-1/2 -translate-y-1/2 opacity-0 transition-all duration-700 flex flex-col items-center">
                        <div class="text-7xl mb-2 filter sepia-[.3]">ğŸª</div>
                        <div class="text-xs text-slate-400 font-bold">éŠ€æ¨“</div>
                    </div>

                    <div id="actor-monster" class="absolute bottom-20 opacity-0 transition-all duration-500 flex flex-col items-center">
                        <div class="text-5xl drop-shadow-md">ğŸ”¥</div>
                        <div class="text-xs text-red-500 font-bold bg-white px-3 py-1 rounded-full shadow-md mt-2 border border-red-100">
                            è€—æ 5%
                        </div>
                    </div>

                    <div id="actor-final-cash" class="absolute opacity-0 transition-all duration-700 flex flex-col items-center z-20">
                        <div class="text-6xl mb-3 drop-shadow-md">ğŸ’µ</div>
                        <div id="display-revenue" class="bg-slate-200 text-slate-700 px-4 py-1.5 rounded-xl font-bold text-sm border border-slate-300 shadow-sm">
                            $-
                        </div>
                        <div class="text-xs text-slate-400 mt-2 font-medium">å›æ”¶ç¾é‡‘</div>
                    </div>

                </div>

                <div class="p-8 bg-white border-t border-slate-100 relative min-h-[160px] z-30">
                    <div id="dialog-box" class="flex gap-5 items-start transition-all duration-300 pr-36">
                        <div class="text-4xl p-3 bg-slate-50 rounded-2xl shadow-inner">ğŸ’ğŸ»â€â™‚ï¸</div>
                        <div>
                            <h3 id="dialog-title" class="font-bold text-slate-800 text-lg mb-1">æº–å‚™é–‹å§‹</h3>
                            <div id="dialog-text" class="text-slate-600 text-sm leading-7">
                                è«‹é¸æ“‡å·¦å´åƒæ•¸ï¼ŒæŒ‰ä¸‹ã€Œé‡ç½®ä¸¦é–‹å§‹æ¨¡æ“¬ã€ã€‚<br>
                                æˆ‘å€‘å°‡ä¸€æ­¥æ­¥æ‹†è§£è³‡é‡‘æµå‘ã€‚
                            </div>
                        </div>
                    </div>
                    
                    <div class="absolute right-8 bottom-8 flex gap-3">
                        <button id="btn-prev" onclick="prevStep()" class="hidden px-5 py-3 rounded-full font-medium text-slate-500 hover:bg-slate-100 transition-all active:scale-95 text-sm">
                            â† ä¸Šä¸€æ­¥
                        </button>
                        <button id="btn-next" onclick="nextStep()" disabled class="bg-blue-600 text-white px-7 py-3 rounded-full font-bold shadow-lg shadow-blue-200 hover:bg-blue-700 transition-all disabled:opacity-30 disabled:cursor-not-allowed active:scale-95 flex items-center gap-2 text-sm">
                            <span>ä¸‹ä¸€æ­¥</span> â†’
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- 1. State Management (ç‹€æ…‹ç®¡ç†) ---
        let state = {
            step: 0,
            cost: 0,
            weightG: 0,
            rewardRate: 0,
            shopPrice: 0,
            lossRate: 0,
            purity: 1.0,
            purityName: "24K",
            // è¨ˆç®—çµæœ
            pointsValue: 0,
            effectiveWeightQian: 0,
            cashRevenue: 0,
            cashProfit: 0,
            totalProfit: 0
        };

        // --- 2. DOM Elements (å…ƒç´ é¸å–) ---
        const els = {
            wallet: document.getElementById('actor-wallet'),
            costco: document.getElementById('scene-costco'),
            gold: document.getElementById('actor-gold'),
            goldLabel: document.getElementById('gold-label'),
            points: document.getElementById('actor-points'),
            shop: document.getElementById('scene-shop'),
            monster: document.getElementById('actor-monster'),
            finalCash: document.getElementById('actor-final-cash'),
            
            displayCost: document.getElementById('display-cost'),
            displayPoints: document.getElementById('display-points'),
            displayRevenue: document.getElementById('display-revenue'),
            
            dialogTitle: document.getElementById('dialog-title'),
            dialogText: document.getElementById('dialog-text'),
            phaseText: document.getElementById('phase-text'),
            
            btnNext: document.getElementById('btn-next'),
            btnPrev: document.getElementById('btn-prev'),
            
            dots: [1,2,3,4].map(i => document.getElementById(`step-dot-${i}`))
        };

        const formatMoney = (num) => new Intl.NumberFormat('zh-TW', { style: 'currency', currency: 'TWD', maximumFractionDigits: 0 }).format(num);

        // --- 3. Initialization (åˆå§‹åŒ–èˆ‡è¨ˆç®—) ---
        function initSimulation() {
            // æŠ“å–æ•¸å€¼
            state.cost = parseFloat(document.getElementById('inputPrice').value);
            state.weightG = parseFloat(document.getElementById('inputWeight').value);
            state.rewardRate = parseFloat(document.getElementById('inputReward').value);
            
            const puritySelect = document.getElementById('inputPurity');
            state.purity = parseFloat(puritySelect.value);
            state.purityName = puritySelect.options[puritySelect.selectedIndex].text.split('(')[0].trim();
            
            state.shopPrice = parseFloat(document.getElementById('inputShopPrice').value);
            state.lossRate = parseFloat(document.getElementById('inputLoss').value);

            // è¨ˆç®—æ ¸å¿ƒ
            state.pointsValue = Math.round(state.cost * (state.rewardRate / 100));
            
            // é»ƒé‡‘é‡é‡è¨ˆç®—å…¬å¼: (å…‹é‡ / 3.75) * æˆè‰² * (1 - æè€—)
            const weightQian = state.weightG / 3.75;
            state.effectiveWeightQian = (weightQian * state.purity) * (1 - (state.lossRate / 100));
            
            state.cashRevenue = Math.round(state.effectiveWeightQian * state.shopPrice);
            state.cashProfit = state.cashRevenue - state.cost;
            state.totalProfit = state.cashProfit + state.pointsValue;

            // UI æ•¸å€¼æ³¨å…¥
            els.displayCost.innerText = formatMoney(state.cost);
            els.displayPoints.innerText = `+ ${formatMoney(state.pointsValue)} é»`;
            els.displayRevenue.innerText = formatMoney(state.cashRevenue);
            els.goldLabel.innerText = state.purity === 1 ? "ç´”é‡‘é£¾å“" : `${state.purityName} é£¾å“`;

            // å•Ÿå‹•ç¬¬ä¸€æ­¥
            state.step = 1;
            els.btnNext.disabled = false;
            updateStep(1);
        }

        // --- 4. Navigation Controls (å°èˆªé‚è¼¯) ---
        function nextStep() {
            if (state.step < 4) {
                state.step++;
                updateStep(state.step);
            } else {
                initSimulation(); // å¾ªç’°å›åˆ°é–‹å§‹
            }
        }

        function prevStep() {
            if (state.step > 1) {
                state.step--;
                updateStep(state.step);
            }
        }

        // --- 5. Animation & State Renderer (å‹•ç•«æ¸²æŸ“æ ¸å¿ƒ) ---
        function updateStep(step) {
            // A. æ›´æ–°é€²åº¦é» (Dots)
            els.dots.forEach((d, i) => {
                if (i < step) {
                    d.classList.remove('bg-slate-300');
                    d.classList.add('bg-blue-600');
                } else {
                    d.classList.remove('bg-blue-600');
                    d.classList.add('bg-slate-300');
                }
            });

            // B. æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
            if (step === 1) {
                els.btnPrev.classList.add('hidden');
                els.btnNext.innerHTML = `<span>ä¸‹ä¸€æ­¥</span> â†’`;
                els.btnNext.className = "bg-blue-600 text-white px-7 py-3 rounded-full font-bold shadow-lg shadow-blue-200 hover:bg-blue-700 transition-all active:scale-95 flex items-center gap-2 text-sm";
            } else if (step === 4) {
                els.btnPrev.classList.remove('hidden');
                els.btnNext.innerHTML = `<span>é‡æ–°è¨ˆç®—</span> â†»`;
                els.btnNext.className = "bg-slate-800 text-white px-7 py-3 rounded-full font-bold shadow-lg hover:bg-black transition-all active:scale-95 flex items-center gap-2 text-sm";
            } else {
                els.btnPrev.classList.remove('hidden');
                els.btnNext.innerHTML = `<span>ä¸‹ä¸€æ­¥</span> â†’`;
                els.btnNext.className = "bg-blue-600 text-white px-7 py-3 rounded-full font-bold shadow-lg shadow-blue-200 hover:bg-blue-700 transition-all active:scale-95 flex items-center gap-2 text-sm";
            }

            // C. å ´æ™¯ç‹€æ…‹åˆ‡æ› (Switch Logic)
            switch (step) {
                case 1: // åˆå§‹ç‹€æ…‹
                    // Reset elements
                    els.wallet.style = "transform: translate(0, 0); opacity: 1;";
                    els.costco.style = "opacity: 0; transform: scale(0.9);";
                    els.gold.style = "opacity: 0; transform: translate(0,0);"; 
                    els.points.style = "opacity: 0; transform: translate(0,0);";
                    els.shop.style = "opacity: 0; right: 40px;";
                    els.monster.style = "opacity: 0;";
                    els.finalCash.style = "opacity: 0;";
                    
                    els.dialogTitle.innerText = "ç¬¬ä¸€æ­¥ï¼šæŠ•å…¥è³‡æœ¬";
                    els.dialogText.innerHTML = `æ‚¨æº–å‚™äº† <b class="text-slate-800">${formatMoney(state.cost)}</b> ç¾é‡‘ã€‚<br>é¸å®šå•†å“ï¼š<b class="text-slate-800">${state.purityName} / ${state.weightG}å…‹</b>ã€‚é€™ç­†è³‡é‡‘å³å°‡è½‰åŒ–ç‚ºè³‡ç”¢ã€‚`;
                    els.phaseText.innerText = "PHASE 1: CAPITAL";
                    break;

                case 2: // è³¼è²·å®Œæˆ
                    els.wallet.style = "opacity: 0; transform: scale(0.5);"; // éŒ¢åŒ…ç¸®å°æ¶ˆå¤±
                    els.costco.style = "opacity: 1; transform: scale(1);";   // å¥½å¸‚å¤šå‡ºç¾
                    
                    // é»ƒé‡‘èˆ‡é»æ•¸å‡ºç¾
                    els.gold.style = "opacity: 1; transform: translate(-60px, 0); transition: all 0.6s ease;";
                    els.points.style = "opacity: 1; transform: translate(60px, -30px); transition: all 0.6s ease 0.1s;";
                    
                    // Reset Phase 3
                    els.shop.style = "opacity: 0; right: 40px;"; 
                    els.monster.style = "opacity: 0;";

                    els.dialogTitle.innerText = "ç¬¬äºŒæ­¥ï¼šè³‡ç”¢åˆ†é›¢";
                    els.dialogText.innerHTML = `äº¤æ˜“å®Œæˆï¼è³‡ç”¢åˆ†è£‚ç‚ºå…©å€‹éƒ¨åˆ†ï¼š<br>1. <b class="text-amber-600">å¯¦é«”é»ƒé‡‘</b> (ç­‰å¾…è®Šç¾)<br>2. <b class="text-blue-600">é»æ•¸å›é¥‹ ${formatMoney(state.pointsValue)}</b> (å·²å®‰å…¨å…¥è¢‹ âœ…)`;
                    els.phaseText.innerText = "PHASE 2: SEPARATION";
                    break;

                case 3: // å‰å¾€éŠ€æ¨“
                    els.costco.style = "opacity: 0; transform: scale(0.9);";
                    
                    // é»æ•¸é£›åˆ°å®‰å…¨å€ (å³ä¸Šè§’)
                    els.points.style = "transform: translate(140px, -180px) scale(0.8); opacity: 1; transition: all 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);"; 
                    
                    // é»ƒé‡‘ç§»å‹•åˆ°ä¸­é–“
                    els.gold.style = "transform: translate(0, 0) scale(1.1); opacity: 1; transition: all 0.6s ease;"; 
                    
                    els.shop.style = "opacity: 1; right: 20px; transition: all 0.6s ease;";
                    els.monster.style = "opacity: 1; transform: translateY(-30px); transition: all 0.6s ease 0.2s;";
                    
                    // Reset Phase 4
                    els.finalCash.style = "opacity: 0;";

                    els.dialogTitle.innerText = "ç¬¬ä¸‰æ­¥ï¼šç«è€—èˆ‡æŠ˜èˆŠ";
                    let warningText = state.purity < 1 
                        ? `<br><span class="text-amber-600 text-xs font-bold">âš ï¸ éç´”é‡‘ç‰©ä»¶ï¼Œå°‡ä¾å«é‡‘é‡ (${state.purityName}) é€²è¡ŒæŠ˜æ‰£ã€‚</span>`
                        : "";
                    els.dialogText.innerHTML = `å‰å¾€éŠ€æ¨“è®Šç¾ã€‚ä¾ç…§è¦å‰‡æ‰£é™¤ <b>${state.lossRate}%</b> æè€—ã€‚${warningText}<br><span class="text-red-500 font-medium animate-pulse">è¨ˆç®—æ©Ÿæ­£åœ¨é‹ä½œä¸­...</span>`;
                    els.phaseText.innerText = "PHASE 3: LIQUIDATION";
                    break;

                case 4: // æœ€çµ‚çµç®—
                    els.gold.style = "opacity: 0; transition: all 0.3s;";
                    els.monster.style = "opacity: 0; transition: all 0.3s;";
                    els.shop.style = "opacity: 0.4; filter: blur(2px); transition: all 0.6s;";
                    
                    els.finalCash.style = "opacity: 1; transform: translate(-70px, 0); transition: all 0.6s ease;";
                    // é»æ•¸é£›å›ä¾†ä¸€èµ·æ¯”è¼ƒ
                    els.points.style = "opacity: 1; transform: translate(70px, 0) scale(1.1); transition: all 0.6s ease;"; 

                    const isCashProfitable = state.cashProfit > 0;
                    const isTotalProfitable = state.totalProfit > 0;
                    const cashClass = isCashProfitable ? 'text-green-600' : 'text-red-500';
                    const totalClass = isTotalProfitable ? 'text-green-600' : 'text-red-500';

                    els.dialogTitle.innerText = "æœ€çµ‚çµæœï¼šçœŸç›¸å¤§ç™½";
                    let resultHTML = `<ul class="space-y-1.5 text-sm mt-1">`;
                    resultHTML += `<li>ğŸ’µ ç¾é‡‘æç›Šï¼š<span class="${cashClass} font-mono font-bold text-base">${formatMoney(state.cashProfit)}</span></li>`;
                    resultHTML += `<li>ğŸ’ é»æ•¸å›é¥‹ï¼š<span class="text-blue-600 font-mono font-bold text-base">+ ${formatMoney(state.pointsValue)}</span></li>`;
                    resultHTML += `<li class="border-t border-slate-200 pt-1.5 mt-1">ğŸ“Š ç¶œåˆæç›Šï¼š<span class="${totalClass} font-mono font-bold text-lg">${formatMoney(state.totalProfit)}</span></li>`;
                    resultHTML += `</ul>`;
                    
                    if (state.purity < 1) {
                         resultHTML += `<p class="text-xs text-slate-400 mt-2">ğŸ’¡ å‚™è¨»ï¼šKé‡‘é£¾å“å› å«é‡‘é‡èˆ‡å›æ”¶æŠ˜æ•¸ï¼Œé€šå¸¸é›£ä»¥åœ¨ç¾é‡‘ç«¯ç²åˆ©ã€‚</p>`;
                    }

                    els.dialogText.innerHTML = resultHTML;
                    els.phaseText.innerText = "PHASE 4: RESULT";
                    break;
            }
        }
    </script>
</body>
</html>
